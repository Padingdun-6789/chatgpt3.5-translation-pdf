# -*- coding: utf-8 -*-
"""Untitled0.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/17WH0ci1sQK-gleNobI-tsmOCPjMZ-lkv
"""

import requests
res = requests.get('https://www.scotch-whisky.org.uk/media/1519/swr-guidance-for-bottlers-and-producers.pdf')
with open('swr-guidance-for-bottlers-and-producers.pdf','wb') as f:
  f.write(res.content)

! pip install pypdf

from pypdf import PdfReader

reader = PdfReader("swr-guidance-for-bottlers-and-producers.pdf")
number_of_pages = len(reader.pages)
page = reader.pages[1]
text = page.extract_text()

text

! pip install nltk

import nltk
nltk.download('punkt')
from nltk.tokenize import sent_tokenize
sentences = sent_tokenize(text)

for sentence in sentences:
  print(sentence)
  print('=' * 20)

! pip install openai

# Note: you need to be using OpenAI Python v0.27.0 for the code below to work
import openai
# Note: you can input your own api key.你可加入你自己的apikey.
# website链接：https://platform.openai.com/account/api-keys
TOKEN = ''
openai.api_key = TOKEN
completion = openai.ChatCompletion.create(
  model="gpt-3.5-turbo",
  messages=[
        {"role": "system", "content": "请帮忙翻译一下的文件成中文简体"},
        {"role": "user", "content": sentences[3]},
        
    ]
)

completion.choices[0].message.content

input_sentences = ''
chunks =[]
for sentence in sentences:
  input_sentences += sentence
  if len(input_sentences) > 1000:
    chunks.append(input_sentences)
    input_sentences = ''
chunks.append(input_sentences)

chunks

import openai
TOKEN = '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'
openai.api_key = TOKEN
completion = openai.ChatCompletion.create(
  model="gpt-3.5-turbo",
  messages=[
        {"role": "system", "content": "请帮忙翻译一下的文件成中文简体"},
        {"role": "user", "content": chunks[0]},
        
    ]
)

completion.choices[0].message.content

"""##  流程整理"""

! pip install pypdf
! pip install openai
! pip install nltk

from pypdf import PdfReader
from nltk.tokenize import sent_tokenize
import requests

res = requests.get('https://www.scotch-whisky.org.uk/media/1519/swr-guidance-for-bottlers-and-producers.pdf')
with open('swr-guidance-for-bottlers-and-producers.pdf','wb') as f:
  f.write(res.content)
pdf_name= "swr-guidance-for-bottlers-and-producers.pdf"
reader = PdfReader(pdf_name)
number_of_pages = len(reader.pages)
chunks =[]
TOKEN = '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'
openai.api_key = TOKEN

for i in range(number_of_pages):
  page = reader.pages[i]
  text = page.extract_text()
  sentences = sent_tokenize(text)
  input_sentences = ''
  
  for sentence in sentences:
   input_sentences += sentence
   if len(input_sentences) > 1000:
    chunks.append(input_sentences)
    input_sentences = ''
  chunks.append(input_sentences)

import time
from google.colab import files

with open('output.txt', 'w') as f:
  f.write("苏格兰威士忌法律2009年 中英对照\n")

for i in range(len(chunks)):
  
  time.sleep(21)
  completion = openai.ChatCompletion.create(
  model="gpt-3.5-turbo",
  messages=[
        {"role": "system", "content": "请帮忙翻译一下的文件成中文简体"},
        {"role": "user", "content": chunks[i]},
        
    ]
  )
  print("传输到部分：",i,chunks[i][0:20])
  with open('output.txt', 'a') as f:
    f.write("原文：" + chunks[i] + '\n')
    f.write("翻译结果：" + completion.choices[0].message.content + '\n')


files.download('output.txt')
